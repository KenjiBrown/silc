#!/bin/sh
#
#  prepare
#
#  Author: Pekka Riikonen <priikone@poseidon.pspt.fi>
#
#  Copyright (C) 2000 - 2001 Pekka Riikonen
#
#  This program is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 2 of the License, or
#  (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#

#
# Prepares SILC source tree for configuration and compilation. This is
# done only after checkout from CVS. This is only for developers of SILC
# and will never appear in public distribution. When creating distributions
# this is always run first. After the distribution is created all
# temporary files (including these prepare* scripts) are removed.
#

SILC_VERSION=0.2.6

version=$1
if test "$version" = ""; then
  version=$SILC_VERSION;
fi

echo "Preparing SILC source tree for configuration and compilation..."

# Replace version string and create configure.in
sed -e "/SILC_VERSION/s//$version/" configure.in.pre >configure.in

aclocal
autoconf
autoheader
automake

cd lib/trq
aclocal
autoconf
autoheader
automake >/dev/null 2>/dev/null
cd ../..

file=includes/version_internal.h
echo "/* Automatically generated by ./prepare */" >$file
echo "#define SILC_VERSION_STRING \"$version\"" >>$file
echo "#define SILC_PROTOCOL_VERSION_STRING \"SILC-1.0-$version\"" >>$file

# preparing irssi
cd irssi
./autogen.sh 2>/dev/null 1>/dev/null
cd ..
file=irssi/irssi-version.h.in
version_date=`date +%Y%m%d`
echo "/* automatically created by autogen.sh */" > $file
echo "#define IRSSI_VERSION \"$version (Irssi base: @VERSION@ - SILC base: SILC Toolkit $version)\"" >> $file
echo "#define IRSSI_VERSION_DATE \"$version_date\"" >> $file

echo "Done, now run ./configure and make."
